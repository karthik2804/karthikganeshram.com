<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Karthik Ganeshram</title><link>/categories/tutorials/</link><description>Recent content from Karthik Ganeshram</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sat, 05 Jun 2021 00:00:00 +0000</lastBuildDate><atom:link href="/categories/tutorials/index.xml" rel="self" type="application/rss+xml"/><item><title>Adding push notifications to static sites</title><link>/blog/adding-push-notifications-to-static-sites/</link><pubDate>Sat, 05 Jun 2021 00:00:00 +0000</pubDate><guid>/blog/adding-push-notifications-to-static-sites/</guid><description>&lt;p&gt;While reading about cloudflare workers, I had this thought of can I use this to trigger push notifications for my static site that has a blog. That is what I did. In this post. I will describe the steps involved in creating push notifications using Firebase Cloud Messaging and Cloudflare workers. This post must not be considered as a tutorial but merely as a guide.&lt;/p&gt;
&lt;p&gt;Cloudflare workers allows us to write serverless code that allows us to build API using the edge nodes of cloudflare. We will create an API that will allow the users of the site to subscribe/unsubscribe to new post notifications. We will also use the ability of CRON triggers to automate sending notifications.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://firebase.google.com/docs/cloud-messaging"&gt;FCM&lt;/a&gt; API allows us to send push messages to the clients to update them of new data and this is exactly what we will be using to send notifications when there are new posts in our static site. We will also use their library on the front-end to handle notifications.&lt;/p&gt;
&lt;h2 id="firebase-cloud-messaging"&gt;Firebase Cloud Messaging&lt;/h2&gt;
&lt;p&gt;First we will need to add the library to our web app. They can be included using the script tags and it must be initiated. Refer to the &lt;a href="https://firebase.google.com/docs/cloud-messaging/js/client"&gt;official documentation&lt;/a&gt; for additional information. Make sure to create a project in firebase if you have not already done it.&lt;/p&gt;
&lt;h6 id="indexhtml"&gt;index.html&lt;/h6&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-html" data-lang="html"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.....
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;script&lt;/span&gt; &lt;span style="color:#309"&gt;src&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;https://www.gstatic.com/firebasejs/8.5.0/firebase-app.js&amp;#34;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;script&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;script&lt;/span&gt; &lt;span style="color:#309"&gt;src&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;https://www.gstatic.com/firebasejs/8.6.2/firebase-messaging.js&amp;#34;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;script&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;....
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h6 id="indexjs"&gt;index.js&lt;/h6&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-js" data-lang="js"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;// Your web app&amp;#39;s Firebase configuration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;// For Firebase JS SDK v7.20.0 and later, measurementId is optional
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;&lt;/span&gt;&lt;span style="color:#069;font-weight:bold"&gt;var&lt;/span&gt; firebaseConfig &lt;span style="color:#555"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#09f;font-style:italic"&gt;/* enter your firebase project details */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;firebase.initializeApp(firebaseConfig)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;// Using a redirect.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Also create a file named &amp;ldquo;firebase-messaging-sw.js&amp;rdquo;. This file will contain the service worker that will handle sending notifications when it receives data from FCM. Initialize it with the following contents. We will fill in the rest later.&lt;/p&gt;
&lt;h6 id="firebase-messaging-swjs"&gt;firebase-messaging-sw.js&lt;/h6&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-js" data-lang="js"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;importScripts(&lt;span style="color:#c30"&gt;&amp;#39;https://www.gstatic.com/firebasejs/8.6.2/firebase-app.js&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;importScripts(&lt;span style="color:#c30"&gt;&amp;#39;https://www.gstatic.com/firebasejs/8.6.2/firebase-messaging.js&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; firebaseConfig &lt;span style="color:#555"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#09f;font-style:italic"&gt;/* enter your firebase project configurations */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;firebase.initializeApp(firebaseConfig)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; messaging &lt;span style="color:#555"&gt;=&lt;/span&gt; firebase.messaging()
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now that the initial setup of firebase is done in the client let us understand how FCM works. So when a client wants to show notifications, it requires the user to allow notifications on the website. Once the notification permission is avaibale, the messaging library of firebase can create a registration token for the user. This token is then shared with the server. The token can be used to send messages to specific devices or can be registed with FCM notifications to subscribe to a topic.&lt;/p&gt;
&lt;p&gt;We will Be registering the token on a topic since, it is a common notification that we desire to all the users. So now let us add the functionality to create the registration token. The vapidKey is available in the cloud messaging tab of the project settings in firebase console.&lt;/p&gt;
&lt;p&gt;&lt;img src="/FCM.jpg" alt="Firebase Cloud Messaging console"&gt;&lt;em&gt;FCM console&lt;/em&gt;&lt;/p&gt;
&lt;h6 id="indexjs-1"&gt;index.js&lt;/h6&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-js" data-lang="js"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; notificationToken
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; notificationStatus &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; getToken &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;async&lt;/span&gt; () =&amp;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; token &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; messaging.getToken({ &lt;span style="color:#c30"&gt;&amp;#39;&amp;lt;YOUR_PUBLIC_VAPID_KEY_HERE&amp;gt;&amp;#39;&lt;/span&gt;})
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt; token
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; main &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;async&lt;/span&gt; () =&amp;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (Notification.permission &lt;span style="color:#555"&gt;!=&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;blocked&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; notificationToken &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; getToken()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; console.log(notificationToken)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;main()
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This script will now initially check if the notification permissions are blocked, else it will trigger the firebase function to get the token. If the permissions for notification is not granted, it will request for it. It is better to trigger the &lt;code&gt;getToken&lt;/code&gt; on the request of the user, this is just to show the process.&lt;/p&gt;
&lt;p&gt;Now we have the FCM registration token, we can look at the FCM API. We will be needing 4 APIs to get push notifications to work. We will need an API for registering and unregistering a user to topic, an API to check the status of the user and finally and most importantly the API that will allow us to push notifications to specific topics.&lt;/p&gt;
&lt;p&gt;The reason we need to use REST APIs and not the firebase-admin package in nodejs is because that pacakge cannot be used in cloudflare workers as it depends on certain node specific features which are not available on workers.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-js" data-lang="js"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;// FCM API
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;// get user status
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;// SERVER_KEY available in firebase cloud messaging tab
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;// IID Token is the firebase messaging registration token
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;// Return an object on success, we are interested in the &amp;#34;rel&amp;#34; key containing the topics subscribed
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;statusURL &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;https://iid.googleapis.com/iid/info/&amp;lt;FCM_REGISTRATION_TOKEN&amp;gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;statusParameters &lt;span style="color:#555"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; headers&lt;span style="color:#555"&gt;:&lt;/span&gt; {&lt;span style="color:#c30"&gt;&amp;#34;Authorization&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;key=&amp;lt;SERVER_KEY&amp;gt;&amp;#34;&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;// Sub user
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;// API_KEY is the same as SERVER_KEY
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;// TOPIC is the name to which we want to subscribe the user to
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; suburl &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;https://iid.googleapis.com/iid/v1:batchAdd&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;subParameters &lt;span style="color:#555"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;headers&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;Content-Type&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;Authorization&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;key=&amp;lt;API_KEY&amp;gt;&amp;#34;&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;body&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;to&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;&amp;lt;TOPIC&amp;gt;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;registration_tokens&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; [&lt;span style="color:#c30"&gt;&amp;#34;&amp;lt;FCM_REGISTRATION_TOKEN&amp;gt;&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; },
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;method&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;// unSub user
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;// API_KEY is the same as SERVER_KEY
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;// TOPIC is the name to which we want to subscribe the user to
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; unsubURL &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;https://iid.googleapis.com/iid/v1:batchRemove&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;unsubParameters &lt;span style="color:#555"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;headers&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;Content-Type&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;Authorization&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;key=&amp;lt;API_KEY&amp;gt;&amp;#34;&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;body&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;to&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;&amp;lt;TOPIC&amp;gt;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;registration_tokens&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; [&lt;span style="color:#c30"&gt;&amp;#34;&amp;lt;FCM_REGISTRATION_TOKEN&amp;gt;&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; },
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;method&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;// Send notification
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;// GOOGLE_OAUTH_ACCESS_TOKEN is needed
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; topicNotificationURL &lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;https://fcm.googleapis.com/v1/projects/329859626245/messages:send&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; topicNotificationParameter &lt;span style="color:#555"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; body&lt;span style="color:#555"&gt;:&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;message&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;data&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; { &lt;span style="color:#c30"&gt;&amp;#34;body&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; data.title, &lt;span style="color:#c30"&gt;&amp;#34;title&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;New Post!&amp;#34;&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#34;image&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;https://karthikganeshram.in&amp;#34;&lt;/span&gt; &lt;span style="color:#555"&gt;+&lt;/span&gt; data.image, &lt;span style="color:#c30"&gt;&amp;#34;tag&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; data.tag, &lt;span style="color:#c30"&gt;&amp;#34;url&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;https://karthikganeshram.in&amp;#34;&lt;/span&gt; &lt;span style="color:#555"&gt;+&lt;/span&gt; data.url},
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;topic&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;newPost&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; },
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; headers&lt;span style="color:#555"&gt;:&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; Authorization&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;Bearer &amp;#34;&lt;/span&gt; &lt;span style="color:#555"&gt;+&lt;/span&gt; GOOGLE_OAUTH_ACCESS_TOKEN,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;Content-Type&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; },
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; method&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I decided to use the batch api for add and remove as I was not able to find the remove api for a single token and wanted to maintain consitency in the API. Now we can test out the commands using curl. We have everything required to test the API except the &lt;code&gt;GOOGLE_OAUTH_ACCESS_TOKEN&lt;/code&gt;. The method to obtain it will be explained soon. In the meantime you can use the &amp;ldquo;Notifcation composer&amp;rdquo; in firebase console to send test messages after you get the registration token.&lt;/p&gt;
&lt;h2 id="cloudflare-workers"&gt;Cloudflare workers&lt;/h2&gt;
&lt;p&gt;Now it is time to move onto workers. It is assumed that the reader has some familiarity with the basics of cloudflare workers. If not don&amp;rsquo;t worry, the &lt;a href="https://developers.cloudflare.com/workers/"&gt;documentation and examples&lt;/a&gt; will get you started. As explained earlier we will have to use REST APIs instead of the firebase-admin package as it is not compatible. Therefore we must manually retrieve the Oauth token for the google api. This excellent example from &lt;a href="https://community.cloudflare.com/t/example-google-oauth-2-0-for-service-accounts-using-cf-worker/258220"&gt;cloudflare community&lt;/a&gt; will get us started. Now that we are able to retrieve google Oauth tokens, we can use curl to test the apis from the command line.&lt;/p&gt;
&lt;p&gt;Let us build the API for the in the workers that our website will use. We will have 3 rest API end points. One each for subStatus, sub and unsub. We will also add a function to send the notification. These are the 4 apis described above. We will also need to add worker secrets for SERVER_KEY and email address of service account in firebase and the private key.&lt;/p&gt;
&lt;h6 id="indexjscloudflare-worker"&gt;index.js(cloudflare worker)&lt;/h6&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-js" data-lang="js"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;async&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt; getToken(){
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#09f;font-style:italic"&gt;/* Use the function provided in the example above and return the token*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;async&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt; subStatus(data) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; console.log(data.token)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; res &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; fetch(&lt;span style="color:#c30"&gt;&amp;#34;https://iid.googleapis.com/iid/info/&amp;#34;&lt;/span&gt; &lt;span style="color:#555"&gt;+&lt;/span&gt; data.token &lt;span style="color:#555"&gt;+&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;?details=true&amp;#34;&lt;/span&gt;, {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; headers&lt;span style="color:#555"&gt;:&lt;/span&gt; { Authorization&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;key=&amp;#34;&lt;/span&gt; &lt;span style="color:#555"&gt;+&lt;/span&gt; SERVER_KEY },
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; method&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; })
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (&lt;span style="color:#555"&gt;!&lt;/span&gt;res.ok) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt; { results&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;failed&amp;#34;&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; data &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; res.json()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt; { results&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;success&amp;#34;&lt;/span&gt;, subStatus&lt;span style="color:#555"&gt;:&lt;/span&gt; (data.rel&lt;span style="color:#555"&gt;?&lt;/span&gt;.topics&lt;span style="color:#555"&gt;?&lt;/span&gt;.newPost &lt;span style="color:#555"&gt;?&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;true&lt;/span&gt; &lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;false&lt;/span&gt;) }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;async&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt; subUnsub(data, action) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; console.log(data.token)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; res &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; fetch(&lt;span style="color:#c30"&gt;&amp;#34;https://iid.googleapis.com/iid/v1:batch&amp;#34;&lt;/span&gt; &lt;span style="color:#555"&gt;+&lt;/span&gt; action, {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; body&lt;span style="color:#555"&gt;:&lt;/span&gt; JSON.stringify({ &lt;span style="color:#c30"&gt;&amp;#34;to&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;/topics/newPost&amp;#34;&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#34;registration_tokens&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; [data.token] }),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; headers&lt;span style="color:#555"&gt;:&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; Authorization&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;key=&amp;#34;&lt;/span&gt; &lt;span style="color:#555"&gt;+&lt;/span&gt; SERVER_KEY,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;Content-Type&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; },
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; method&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; })
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (&lt;span style="color:#555"&gt;!&lt;/span&gt;res.ok) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt; { results&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;failed&amp;#34;&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt; { results&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;success&amp;#34;&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;async&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt; sendNotification(data) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; res &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; fetch(&lt;span style="color:#c30"&gt;&amp;#34;https://fcm.googleapis.com/v1/projects/329859626245/messages:send&amp;#34;&lt;/span&gt;, {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; body&lt;span style="color:#555"&gt;:&lt;/span&gt; JSON.stringify({
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;message&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;data&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; { &lt;span style="color:#c30"&gt;&amp;#34;body&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; data.title, &lt;span style="color:#c30"&gt;&amp;#34;title&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;New Post!&amp;#34;&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#34;image&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; data.image, &lt;span style="color:#c30"&gt;&amp;#34;tag&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; data.tag, &lt;span style="color:#c30"&gt;&amp;#34;url&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; data.url},
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;topic&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;newPost&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; headers&lt;span style="color:#555"&gt;:&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; Authorization&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;Bearer &amp;#34;&lt;/span&gt; &lt;span style="color:#555"&gt;+&lt;/span&gt; GOOGLE_OAUTH_ACCESS_TOKEN,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#34;Content-Type&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; },
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; method&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; })
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (&lt;span style="color:#555"&gt;!&lt;/span&gt;res.ok) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt; { results&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;failed&amp;#34;&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt; { results&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;success&amp;#34;&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;async&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt; handleRequest(request) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; console.log(&lt;span style="color:#c30"&gt;&amp;#34;here&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; url &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;new&lt;/span&gt; URL(request.url)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; response
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (request.method &lt;span style="color:#555"&gt;===&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; { headers } &lt;span style="color:#555"&gt;=&lt;/span&gt; request
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (headers.get(&lt;span style="color:#c30"&gt;&amp;#34;content-type&amp;#34;&lt;/span&gt;) &lt;span style="color:#555"&gt;==&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;switch&lt;/span&gt; (url.pathname) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;case&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;/api/notify/sub&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; response &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; subUnsub((&lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; request.json()), &lt;span style="color:#c30"&gt;&amp;#34;Add&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;break&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;case&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;/api/notify/unsub&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; response &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; subUnsub((&lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; request.json()), &lt;span style="color:#c30"&gt;&amp;#34;Remove&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;break&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;case&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;/api/notify/subStatus&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; response &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; subStatus(&lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; request.json())
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;break&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; response &lt;span style="color:#555"&gt;=&lt;/span&gt; {results&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;Invalid URL&amp;#34;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;new&lt;/span&gt; Response(JSON.stringify(response), {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; headers&lt;span style="color:#555"&gt;:&lt;/span&gt; { &lt;span style="color:#c30"&gt;&amp;#39;content-type&amp;#39;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#39;application/json&amp;#39;&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#39;Access-Control-Allow-Origin&amp;#39;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#39;*&amp;#39;&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#39;Access-Control-Allow-Credentials&amp;#39;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#39;true&amp;#39;&lt;/span&gt; },
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; })
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;addEventListener(&lt;span style="color:#c30"&gt;&amp;#34;fetch&amp;#34;&lt;/span&gt;, event =&amp;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; request &lt;span style="color:#555"&gt;=&lt;/span&gt; event.request
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; request.method &lt;span style="color:#555"&gt;===&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; console.log(&lt;span style="color:#c30"&gt;&amp;#34;here&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; event.respondWith(handleRequest(request))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; event.respondWith(
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;new&lt;/span&gt; Response(&lt;span style="color:#069;font-weight:bold"&gt;null&lt;/span&gt;, {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; status&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#f60"&gt;405&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; statusText&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;Method Not Allowed&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; )
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;})
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You may notice that the &lt;code&gt;sendNotificaion&lt;/code&gt; function is not being used. If you want to keep it simple and send the push notifications manually, you can add an api endpoint for the push notification but we will go one step further and automate it using CRON triggers so it will become clearer in just a bit. Now how do we automatically detect if the website has been updated. Well let us find out.&lt;/p&gt;
&lt;p&gt;We need to create a new page on our website which will be a static website that will be updated with the details of the last post along with the time it was updated. We will use CRON triggers on the cloudflare worker to check periodically if there was a new post. If there is a new post we push notifications.&lt;/p&gt;
&lt;p&gt;Now to compare if the date specified on the api is newer than the last notification, we must be able to store global variables in the worker script, that is where cloudflare kv comes in. Let us create a namespace for kv. Namespaces in cloudflare are nothing but a way to reference the objects in the worker script. Run the following command in the command line and save its output to &amp;ldquo;wrangler.toml&amp;rdquo;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-js" data-lang="js"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;wrangler kv&lt;span style="color:#555"&gt;:&lt;/span&gt;namespace create &lt;span style="color:#c30"&gt;&amp;#34;NOTIFICATIONS_KV_DB&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now let us add a function to check if there is a newer post. I use github pages for my static site so I used the raw user content file from the repository as my api. The return of the API is a JSON that has the required parameters. An example response is as below.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-js" data-lang="js"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;{&lt;span style="color:#c30"&gt;&amp;#34;Date&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#f60"&gt;1623083600005&lt;/span&gt;,&lt;span style="color:#c30"&gt;&amp;#34;title&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;Be selfish to be selfless&amp;#34;&lt;/span&gt;,&lt;span style="color:#c30"&gt;&amp;#34;url&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;/blog/posts/be-selfish-to-be-selfless/&amp;#34;&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#34;image&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;/manInSunset.jpg&amp;#34;&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#34;tag&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;Life&amp;#34;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h6 id="indexjscloudflare-worker-1"&gt;index.js(cloudflare worker)&lt;/h6&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-js" data-lang="js"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; setCache &lt;span style="color:#555"&gt;=&lt;/span&gt; data =&amp;gt; NOTIFICATIONS_KV_DB.put(&lt;span style="color:#c30"&gt;&amp;#34;lastPostTime&amp;#34;&lt;/span&gt;, data)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; getCache &lt;span style="color:#555"&gt;=&lt;/span&gt; () =&amp;gt; NOTIFICATIONS_KV_DB.get(&lt;span style="color:#c30"&gt;&amp;#34;lastPostTime&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;async&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt; checkLatestPost() {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; cache &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; getCache()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (&lt;span style="color:#555"&gt;!&lt;/span&gt;cache) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; console.log(&lt;span style="color:#c30"&gt;&amp;#34;settimg cache&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; lastBlogPost &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#f60"&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; lastBlogPost &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#366"&gt;parseInt&lt;/span&gt;(cache)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; res &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; fetch(&lt;span style="color:#c30"&gt;&amp;#34;&amp;lt;Static JSON API&amp;gt;&amp;#34;&lt;/span&gt;, {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; method&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; })
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (&lt;span style="color:#555"&gt;!&lt;/span&gt;res.ok) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt; { results&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;failed&amp;#34;&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; test &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; res.text()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; console.log(&lt;span style="color:#c30"&gt;&amp;#34;succeded &amp;#34;&lt;/span&gt;, res.status, JSON.parse(test))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; data &lt;span style="color:#555"&gt;=&lt;/span&gt; JSON.parse(test)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (lastBlogPost &lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt; data.&lt;span style="color:#366"&gt;Date&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; GOOGLE_OAUTH_ACCESS_TOKEN &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; getToken()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; response &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; sendNotification(data)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (response.results &lt;span style="color:#555"&gt;===&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;success&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; lastBlogPost &lt;span style="color:#555"&gt;=&lt;/span&gt; data.&lt;span style="color:#366"&gt;Date&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; setCache(JSON.stringify(data.&lt;span style="color:#366"&gt;Date&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt; { results&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;success&amp;#34;&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;addEventListener(&lt;span style="color:#c30"&gt;&amp;#34;scheduled&amp;#34;&lt;/span&gt;, event =&amp;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; event.waitUntil(checkLatestPost(event))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;})
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now create a CRON trigger using wrangler with the appropriate duration.&lt;/p&gt;
&lt;h2 id="eleventy-static-api"&gt;Eleventy Static API&lt;/h2&gt;
&lt;p&gt;Creating a static API with eleventy is rather straightforward. We just need to create a template file similar to&lt;/p&gt;
&lt;h6 id="lastestpostjson"&gt;lastestPost.json&lt;/h6&gt;
&lt;p&gt;{% raw %}&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-js" data-lang="js"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#555"&gt;---&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;permalink&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;/api/latestPost.json&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#555"&gt;---&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;{&lt;span style="color:#555"&gt;%&lt;/span&gt; set latestPost &lt;span style="color:#555"&gt;=&lt;/span&gt; collections[&lt;span style="color:#c30"&gt;&amp;#34;post&amp;#34;&lt;/span&gt;].reverse()[&lt;span style="color:#f60"&gt;0&lt;/span&gt;] &lt;span style="color:#555"&gt;%&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;{&lt;span style="color:#c30"&gt;&amp;#34;Date&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#f60"&gt;1623083600005&lt;/span&gt;,&lt;span style="color:#c30"&gt;&amp;#34;title&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;{{latestPost.data.title}}&amp;#34;&lt;/span&gt;,&lt;span style="color:#c30"&gt;&amp;#34;url&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;{{latestPost.url}}&amp;#34;&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#34;image&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;{{latestPost.data.mainImage}}&amp;#34;&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#34;tag&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;{{latestPost.data.tags[1]}}&amp;#34;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;{&lt;span style="color:#555"&gt;%&lt;/span&gt; endraw &lt;span style="color:#555"&gt;%&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="handling-notifications-on-client"&gt;Handling notifications on client&lt;/h2&gt;
&lt;p&gt;Now that we have all the parts working, We now add the functions to add/remove user from topic and also check the status of the user. I will let the process of calling them based on the action of the users upto you. we can create the event handlers to handle the notification when it arrives.&lt;/p&gt;
&lt;h6 id="indexjs-2"&gt;index.js&lt;/h6&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-js" data-lang="js"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; enableNotifications &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;async&lt;/span&gt; () =&amp;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (Notification.permission &lt;span style="color:#555"&gt;===&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;granted&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; notificationToken &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; getToken()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; subscribteTopic()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;else&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (Notification.permission &lt;span style="color:#555"&gt;===&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;blocked&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; alert(&lt;span style="color:#c30"&gt;&amp;#34;Notification permissions have been blocked, enable notifications permission manually&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; alert(&lt;span style="color:#c30"&gt;&amp;#34;Now you will be asked for notification permissions&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; notificationToken &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; getToken()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; subscribteTopic()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; subscribteTopic() =&amp;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; subUnsub(&lt;span style="color:#c30"&gt;&amp;#34;sub&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; disableNotifications &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;async&lt;/span&gt; () =&amp;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; notificationToken &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; getToken()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; subUnsub(&lt;span style="color:#c30"&gt;&amp;#34;unsub&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; subUnsub &lt;span style="color:#555"&gt;=&lt;/span&gt; (action) =&amp;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; fetch(notifyApiUrl &lt;span style="color:#555"&gt;+&lt;/span&gt; action, {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; body&lt;span style="color:#555"&gt;:&lt;/span&gt; JSON.stringify({ &lt;span style="color:#c30"&gt;&amp;#34;token&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; notificationToken }),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; headers&lt;span style="color:#555"&gt;:&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#c30"&gt;&amp;#39;Content-Type&amp;#39;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#39;application/json&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; },
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; method&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }).then(res =&amp;gt; res.json()).then(data =&amp;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (data.results &lt;span style="color:#555"&gt;===&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;success&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; console.log(&lt;span style="color:#c30"&gt;&amp;#34;success&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; notificationStatus &lt;span style="color:#555"&gt;=&lt;/span&gt; (action &lt;span style="color:#555"&gt;===&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;sub&amp;#34;&lt;/span&gt; &lt;span style="color:#555"&gt;?&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;true&lt;/span&gt; &lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;false&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; })
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; subStatus() {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; fetch(notifyApiUrl &lt;span style="color:#555"&gt;+&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;subStatus&amp;#34;&lt;/span&gt;, {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; body&lt;span style="color:#555"&gt;:&lt;/span&gt; JSON.stringify({ &lt;span style="color:#c30"&gt;&amp;#34;token&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; notificationToken }),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; headers&lt;span style="color:#555"&gt;:&lt;/span&gt; { &lt;span style="color:#c30"&gt;&amp;#39;Content-Type&amp;#39;&lt;/span&gt;&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#39;application/json&amp;#39;&lt;/span&gt; },
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; method&lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; })
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; data &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;await&lt;/span&gt; res.json()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt; data
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;messaging.onMessage((payload) =&amp;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; console.log(&lt;span style="color:#c30"&gt;&amp;#39;Message received. &amp;#39;&lt;/span&gt;, payload)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now finally to handling the notifications in the service worker. We create a notification object with the data that we receive from the push notification.&lt;/p&gt;
&lt;p&gt;&lt;img src="/mobNotif.jpg" alt="Mobile push notification"&gt;&lt;em&gt;Push notification on mobile&lt;/em&gt;&lt;/p&gt;
&lt;h6 id="firebase-messaging-swjs-1"&gt;firebase-messaging-sw.js&lt;/h6&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-js" data-lang="js"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;messaging.setBackgroundMessageHandler((payload) =&amp;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; console.log(&lt;span style="color:#c30"&gt;&amp;#39;[firebase-messaging-sw.js] Received background message &amp;#39;&lt;/span&gt;, payload);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#09f;font-style:italic"&gt;// Customize notification here
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; notificationTitle &lt;span style="color:#555"&gt;=&lt;/span&gt; payload.data.title;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;const&lt;/span&gt; notificationOptions &lt;span style="color:#555"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; body&lt;span style="color:#555"&gt;:&lt;/span&gt; payload.data.body,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; image&lt;span style="color:#555"&gt;:&lt;/span&gt; payload.data.image,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; };
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; myUrl &lt;span style="color:#555"&gt;=&lt;/span&gt; payload.data.url;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self.addEventListener(&lt;span style="color:#c30"&gt;&amp;#39;notificationclick&amp;#39;&lt;/span&gt;, &lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt;(event) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; event.waitUntil(self.clients.openWindow(myUrl));
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; event.notification.close();
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; })
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self.registration.showNotification(notificationTitle,notificationOptions);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;});
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And voilà, there we have working push notifications whenever there is a new post on my website. I will add some common issues you may face.&lt;/p&gt;
&lt;h3 id="note"&gt;Note&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;CORS error when using testing with localhost. The &lt;a href="https://support.cloudflare.com/hc/en-us/articles/200308847-Using-cross-origin-resource-sharing-CORS-with-Cloudflare"&gt;cloudflare example&lt;/a&gt; will help.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If you need any futher detail or the post is missing, please leave a comment or contact me via my &lt;a href="mailto:raams.karthik@gmail.com"&gt;email&lt;/a&gt;.&lt;/p&gt;</description></item><item><title>Creating content cards using CSS grids in eleventy</title><link>/blog/creating-content-cards-using-css-grids-in-eleventy/</link><pubDate>Sat, 22 May 2021 00:00:00 +0000</pubDate><guid>/blog/creating-content-cards-using-css-grids-in-eleventy/</guid><description>&lt;p&gt;I have always avoided CSS grids and preferred using flexboxes in places where grids would have been the better choice. I finally decided to overcome the fear and finally explore it. In this short post, we will implement a content card using CSS grid which can be used for displaying a list of latest posts or suggest similar posts in an eleventy blog. It should be straightforward to convert it to the other Static site generators.&lt;/p&gt;
&lt;p&gt;We will create a component in nunjucks that takes an input array of eleventy posts and creates a card listing. The component will also optionally take a value that decides if the component places the card in a single row with horizontal scrolling support or allows the listing to span multiple lines.&lt;/p&gt;
&lt;p&gt;We first create the nunjucks template for the suggestion cards.&lt;/p&gt;
&lt;h6 id="suggestedpostsnjk"&gt;suggestedPosts.njk&lt;/h6&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-js" data-lang="js"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;{&lt;span style="color:#555"&gt;%&lt;/span&gt; raw &lt;span style="color:#555"&gt;%&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;div &lt;span style="color:#069;font-weight:bold"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;suggested-postsList {% if suggestedPostScrollHorizontal %} grid-horizontal-scroll {% endif %}&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; {&lt;span style="color:#555"&gt;%&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;for&lt;/span&gt; post &lt;span style="color:#069;font-weight:bold"&gt;in&lt;/span&gt; suggestedPosts &lt;span style="color:#555"&gt;%&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;a &lt;span style="color:#069;font-weight:bold"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;suggested-item&amp;#34;&lt;/span&gt; href&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;{{post.url}}&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;img src&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;{{post.data.mainImage}}&amp;#34;&lt;/span&gt; loading&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;lazy&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;div &lt;span style="color:#069;font-weight:bold"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;content flex flex-column w-100 h-100&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;h2 &lt;span style="color:#069;font-weight:bold"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;pa1&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt;{{post.data.title &lt;span style="color:#555"&gt;|&lt;/span&gt; trimTitle }}&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;&lt;span style="color:#a00;background-color:#faa"&gt;/h2&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;div &lt;span style="color:#069;font-weight:bold"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;description flex-grow-1&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt;{{post.data.content &lt;span style="color:#555"&gt;|&lt;/span&gt; trimContent &lt;span style="color:#555"&gt;|&lt;/span&gt; safe }}&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;&lt;span style="color:#a00;background-color:#faa"&gt;/div&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;div &lt;span style="color:#069;font-weight:bold"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;date&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; {{post.date &lt;span style="color:#555"&gt;|&lt;/span&gt; formatPostDate }}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;span aria&lt;span style="color:#555"&gt;-&lt;/span&gt;hidden&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt;&lt;span style="color:#a00;background-color:#faa"&gt;⋅&lt;/span&gt;&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;&lt;span style="color:#a00;background-color:#faa"&gt;/span&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; {&lt;span style="color:#555"&gt;%-&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;for&lt;/span&gt; tag &lt;span style="color:#069;font-weight:bold"&gt;in&lt;/span&gt; post.data.tags &lt;span style="color:#555"&gt;-%&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; {&lt;span style="color:#555"&gt;%-&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; tag &lt;span style="color:#555"&gt;!=&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;post&amp;#34;&lt;/span&gt; &lt;span style="color:#555"&gt;-%&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;span&lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; {{ tag }}&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;&lt;span style="color:#a00;background-color:#faa"&gt;/span&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; {&lt;span style="color:#555"&gt;%-&lt;/span&gt; endif &lt;span style="color:#555"&gt;-%&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; {&lt;span style="color:#555"&gt;%-&lt;/span&gt; endfor &lt;span style="color:#555"&gt;-%&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;&lt;span style="color:#a00;background-color:#faa"&gt;/div&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;&lt;span style="color:#a00;background-color:#faa"&gt;/div&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;&lt;span style="color:#a00;background-color:#faa"&gt;/a&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; {&lt;span style="color:#555"&gt;%&lt;/span&gt; endfor &lt;span style="color:#555"&gt;%&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;&lt;span style="color:#a00;background-color:#faa"&gt;/div&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;{&lt;span style="color:#555"&gt;%&lt;/span&gt; endraw &lt;span style="color:#555"&gt;%&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &amp;ldquo;suggested-postsList&amp;rdquo; div is the container for the list of cards. The configurable option that will scroll the grid horizontally instead of shifting the cards to a new row can be set by setting the value of the &lt;em&gt;suggestedPostScrollHorizontal&lt;/em&gt; to true using the nunjucks set directive in the parent layout.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-js" data-lang="js"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;{&lt;span style="color:#555"&gt;%&lt;/span&gt; raw &lt;span style="color:#555"&gt;%&lt;/span&gt;}{&lt;span style="color:#555"&gt;%&lt;/span&gt; set suggestedPostScrollHorizontal &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;true&lt;/span&gt; &lt;span style="color:#555"&gt;%&lt;/span&gt;}{&lt;span style="color:#555"&gt;%&lt;/span&gt; endraw &lt;span style="color:#555"&gt;%&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;em&gt;SuggestedPosts&lt;/em&gt; is an array of eleventy posts set in the parent layout and all the posts in this variable are listed by the component. Therefore, any filtering of the content must be done before the array is before the component is called.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-js" data-lang="js"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;{&lt;span style="color:#555"&gt;%&lt;/span&gt; raw &lt;span style="color:#555"&gt;%&lt;/span&gt;}{&lt;span style="color:#555"&gt;%&lt;/span&gt; set suggestedPosts &lt;span style="color:#555"&gt;=&lt;/span&gt; collections[&lt;span style="color:#c30"&gt;&amp;#34;post&amp;#34;&lt;/span&gt;].slice(&lt;span style="color:#f60"&gt;0&lt;/span&gt;,&lt;span style="color:#f60"&gt;6&lt;/span&gt;).reverse() &lt;span style="color:#555"&gt;%&lt;/span&gt;}{&lt;span style="color:#555"&gt;%&lt;/span&gt; endraw &lt;span style="color:#555"&gt;%&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now that we are done with the nunjucks template, let us add the CSS for the component to complete it. The CSS is pretty straightforward. It utilizes a simple CSS grid with an image covering the entire span of each component. It is necessary to add an overlay over the image to make the text on the card readable. We apply it using gradients. The smaller text sizes need a darker gradient and hence we add a second background gradient on those elements. To add for some interactivity the post content is visible only on hover.&lt;/p&gt;
&lt;h6 id="indexcss"&gt;index.css&lt;/h6&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-css" data-lang="css"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;suggest-card&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;width&lt;/span&gt;: &lt;span style="color:#f60"&gt;100&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;suggested-postsList&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;display&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;grid&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;grid-template-columns&lt;/span&gt;: &lt;span style="color:#c0f"&gt;repeat&lt;/span&gt;(&lt;span style="color:#069;font-weight:bold"&gt;auto&lt;/span&gt;&lt;span style="color:#555"&gt;-&lt;/span&gt;&lt;span style="color:#069;font-weight:bold"&gt;fill&lt;/span&gt;,&lt;span style="color:#c0f"&gt;minmax&lt;/span&gt;(&lt;span style="color:#f60"&gt;245&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;px&lt;/span&gt;,&lt;span style="color:#f60"&gt;1&lt;/span&gt;fr));
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;grid-auto-columns&lt;/span&gt;: &lt;span style="color:#f60"&gt;300&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;px&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;grid-gap&lt;/span&gt;: &lt;span style="color:#f60"&gt;2&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;rem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;grid-horizontal-scroll&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;grid-auto-flow&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;column&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;overflow-x&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;auto&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;suggested-item&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;height&lt;/span&gt;: &lt;span style="color:#f60"&gt;300&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;px&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;position&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;relative&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;border-radius&lt;/span&gt;: &lt;span style="color:#f60"&gt;10&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;px&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;overflow&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;hidden&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;suggested-item&lt;/span&gt;::&lt;span style="color:#99f"&gt;before&lt;/span&gt;{&lt;span style="color:#069;font-weight:bold"&gt;display&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;none&lt;/span&gt;;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;suggested-item&lt;/span&gt; &lt;span style="color:#309;font-weight:bold"&gt;img&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;z-index&lt;/span&gt;: &lt;span style="color:#f60"&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;position&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;absolute&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;width&lt;/span&gt;: &lt;span style="color:#f60"&gt;100&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;height&lt;/span&gt;: &lt;span style="color:#f60"&gt;100&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;top&lt;/span&gt;: &lt;span style="color:#f60"&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;left&lt;/span&gt;: &lt;span style="color:#f60"&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;object-fit&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;cover&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;filter&lt;/span&gt;: &lt;span style="color:#366"&gt;blur&lt;/span&gt;(&lt;span style="color:#f60"&gt;1&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;px&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;transition&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;all&lt;/span&gt; &lt;span style="color:#f60"&gt;0.2&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;s&lt;/span&gt; &lt;span style="color:#366"&gt;cubic-bezier&lt;/span&gt;(&lt;span style="color:#f60"&gt;.4&lt;/span&gt;, &lt;span style="color:#f60"&gt;0&lt;/span&gt;, &lt;span style="color:#f60"&gt;.2&lt;/span&gt;, &lt;span style="color:#f60"&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;suggested-item&lt;/span&gt; .&lt;span style="color:#0a8;font-weight:bold"&gt;content&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;z-index&lt;/span&gt;: &lt;span style="color:#f60"&gt;2&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;width&lt;/span&gt;: &lt;span style="color:#f60"&gt;100&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;white&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;position&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;relative&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;background&lt;/span&gt;: &lt;span style="color:#366"&gt;linear-gradient&lt;/span&gt;(&lt;span style="color:#069;font-weight:bold"&gt;to&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;right&lt;/span&gt;, &lt;span style="color:#366"&gt;rgba&lt;/span&gt;(&lt;span style="color:#f60"&gt;0&lt;/span&gt;,&lt;span style="color:#f60"&gt;0&lt;/span&gt;,&lt;span style="color:#f60"&gt;0&lt;/span&gt;,&lt;span style="color:#f60"&gt;0.4&lt;/span&gt;) , &lt;span style="color:#366"&gt;rgba&lt;/span&gt;(&lt;span style="color:#f60"&gt;0&lt;/span&gt;, &lt;span style="color:#f60"&gt;0&lt;/span&gt;, &lt;span style="color:#f60"&gt;0&lt;/span&gt;, &lt;span style="color:#f60"&gt;0.4&lt;/span&gt;));
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;suggested-item&lt;/span&gt; .&lt;span style="color:#0a8;font-weight:bold"&gt;content&lt;/span&gt; &lt;span style="color:#309;font-weight:bold"&gt;h2&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;font-size&lt;/span&gt;: &lt;span style="color:#f60"&gt;1.25&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;rem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;margin&lt;/span&gt;: &lt;span style="color:#f60"&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;suggested-item&lt;/span&gt; .&lt;span style="color:#0a8;font-weight:bold"&gt;content&lt;/span&gt; &lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;background&lt;/span&gt;: &lt;span style="color:#366"&gt;linear-gradient&lt;/span&gt;(&lt;span style="color:#069;font-weight:bold"&gt;to&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;bottom&lt;/span&gt;, &lt;span style="color:#366"&gt;rgba&lt;/span&gt;(&lt;span style="color:#f60"&gt;2&lt;/span&gt;,&lt;span style="color:#f60"&gt;0&lt;/span&gt;,&lt;span style="color:#f60"&gt;36&lt;/span&gt;,&lt;span style="color:#f60"&gt;0&lt;/span&gt;) &lt;span style="color:#f60"&gt;0&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;%&lt;/span&gt;, &lt;span style="color:#366"&gt;rgba&lt;/span&gt;(&lt;span style="color:#f60"&gt;0&lt;/span&gt;,&lt;span style="color:#f60"&gt;0&lt;/span&gt;,&lt;span style="color:#f60"&gt;0&lt;/span&gt;,&lt;span style="color:#f60"&gt;0.12&lt;/span&gt;) &lt;span style="color:#f60"&gt;10&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;%&lt;/span&gt;, &lt;span style="color:#366"&gt;rgba&lt;/span&gt;(&lt;span style="color:#f60"&gt;0&lt;/span&gt;,&lt;span style="color:#f60"&gt;0&lt;/span&gt;,&lt;span style="color:#f60"&gt;0&lt;/span&gt;,&lt;span style="color:#f60"&gt;0.2&lt;/span&gt;));
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;font-size&lt;/span&gt;: &lt;span style="color:#f60"&gt;0.9&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;rem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;line-height&lt;/span&gt;: &lt;span style="color:#f60"&gt;1.2&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;rem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;white&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;margin&lt;/span&gt;: &lt;span style="color:#f60"&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;transition&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;all&lt;/span&gt; &lt;span style="color:#f60"&gt;0.2&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;s&lt;/span&gt; &lt;span style="color:#366"&gt;cubic-bezier&lt;/span&gt;(&lt;span style="color:#f60"&gt;.4&lt;/span&gt;, &lt;span style="color:#f60"&gt;0&lt;/span&gt;, &lt;span style="color:#f60"&gt;.2&lt;/span&gt;, &lt;span style="color:#f60"&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;overflow&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;hidden&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;padding&lt;/span&gt;:&lt;span style="color:#f60"&gt;1&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;rem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;suggested-item&lt;/span&gt; .&lt;span style="color:#0a8;font-weight:bold"&gt;content&lt;/span&gt; &lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;description&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;opacity&lt;/span&gt;: &lt;span style="color:#f60"&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;transform&lt;/span&gt;: &lt;span style="color:#366"&gt;translateY&lt;/span&gt;(&lt;span style="color:#f60"&gt;10&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;px&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;suggested-item&lt;/span&gt; .&lt;span style="color:#0a8;font-weight:bold"&gt;content&lt;/span&gt; &lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;date&lt;/span&gt;{&lt;span style="color:#069;font-weight:bold"&gt;opacity&lt;/span&gt;: &lt;span style="color:#f60"&gt;0.8&lt;/span&gt;;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;suggested-item&lt;/span&gt;:&lt;span style="color:#99f"&gt;hover&lt;/span&gt; &lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt; .&lt;span style="color:#0a8;font-weight:bold"&gt;content&lt;/span&gt; &lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;date&lt;/span&gt;{&lt;span style="color:#069;font-weight:bold"&gt;background&lt;/span&gt;: &lt;span style="color:#366"&gt;linear-gradient&lt;/span&gt;(&lt;span style="color:#069;font-weight:bold"&gt;to&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;bottom&lt;/span&gt;, &lt;span style="color:#366"&gt;rgba&lt;/span&gt;(&lt;span style="color:#f60"&gt;2&lt;/span&gt;,&lt;span style="color:#f60"&gt;0&lt;/span&gt;,&lt;span style="color:#f60"&gt;36&lt;/span&gt;,&lt;span style="color:#f60"&gt;0.2&lt;/span&gt;), &lt;span style="color:#366"&gt;rgba&lt;/span&gt;(&lt;span style="color:#f60"&gt;0&lt;/span&gt;,&lt;span style="color:#f60"&gt;0&lt;/span&gt;,&lt;span style="color:#f60"&gt;0&lt;/span&gt;,&lt;span style="color:#f60"&gt;0.2&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;suggested-item&lt;/span&gt; .&lt;span style="color:#0a8;font-weight:bold"&gt;content&lt;/span&gt; &lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt; &lt;span style="color:#309;font-weight:bold"&gt;p&lt;/span&gt;{&lt;span style="color:#069;font-weight:bold"&gt;margin&lt;/span&gt;: &lt;span style="color:#f60"&gt;0&lt;/span&gt;;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;suggested-item&lt;/span&gt;:&lt;span style="color:#99f"&gt;hover&lt;/span&gt; &lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt; .&lt;span style="color:#0a8;font-weight:bold"&gt;content&lt;/span&gt; &lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;description&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;opacity&lt;/span&gt;: &lt;span style="color:#f60"&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;transform&lt;/span&gt;: &lt;span style="color:#366"&gt;translateY&lt;/span&gt;(&lt;span style="color:#f60"&gt;0&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;suggested-item&lt;/span&gt;:&lt;span style="color:#99f"&gt;hover&lt;/span&gt; &lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt; &lt;span style="color:#309;font-weight:bold"&gt;img&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;filter&lt;/span&gt;: &lt;span style="color:#366"&gt;blur&lt;/span&gt;(&lt;span style="color:#f60"&gt;2&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;px&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;transform&lt;/span&gt;: &lt;span style="color:#366"&gt;scale&lt;/span&gt;(&lt;span style="color:#f60"&gt;1.1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now that we have the entire component ready, it can be used to display the latest posts or whatever one can imagine in the form of cards. A couple of examples of the components with and without horizontal scrolling can be seen below.&lt;/p&gt;
&lt;video controls autoplay&gt;
&lt;source src="/card-scroll.webm" type="video/webm"&gt;
Your browser does not support the video tag.
&lt;/video&gt;
&lt;p&gt;You may also find it at the end of this post if you are reading on a smaller screen.&lt;/p&gt;
&lt;p&gt;Until next time, ciao!&lt;/p&gt;</description></item><item><title>Adding Comments to Eleventy Website with Google Sheets and Forms</title><link>/blog/adding-comments-to-eleventy-website-with-google-sheets-and-forms/</link><pubDate>Mon, 10 May 2021 00:00:00 +0000</pubDate><guid>/blog/adding-comments-to-eleventy-website-with-google-sheets-and-forms/</guid><description>&lt;p&gt;During my latest redesign of my website, I explored Static Site Generators and ended up using eleventy. Contrary to popular belief, a static website doesn’t mean that you must give up on all the fun that dynamic pages provide. In this article, I will talk about how I added a comments section to my blog posts using free google services (forms, sheets and firebase).&lt;/p&gt;
&lt;p&gt;The path to implementing comments in an eleventy blog includes using google forms to collect comment responses which are in google sheets. I chose firebase for authentication as it is very straightforward to implement it..&lt;/p&gt;
&lt;p&gt;To start things off, let us set up google forms with the required fields. The fields that we will be needing are a post identifier, commenter’s name, the content of the comment and the email address provided by firebase authentication. We will be using the article url as the post identifier. Create a new form with the fields.&lt;/p&gt;
&lt;p&gt;Open up the form in preview mode (use the eye icon) and then open developer console. Now we will note down the unique name attribute for each of the fields. To do this, in the elements tab of the developer console search for “entry.”. This will show us 4 entries. They are the name attributes that we must use in our form while submitting from our blog post, so note them down. The order is the same order of our fields. We also need to note down the url for the action attribute of the form.&lt;/p&gt;
&lt;p&gt;&lt;img src="/forms.png" alt="&amp;ldquo;Google forms with required field&amp;rdquo;"&gt;&lt;em&gt;Google forms with required field&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Now that the google form is set up, it is time to link it to a google sheet.Go into the responses tab of the form and attach it to a spreadsheet. Open up the spreadsheet and add an extra field called isAuthor. This field is never filled up by the form, we will use an ArrayFunction to fill it up as the data arrives. The sheet should be publicly viewable but not editable. Set the permissions in link sharing and save the url as it will be required later.&lt;/p&gt;
&lt;p&gt;Now let us add a couple of formulas and formatting. First, let us set “Timestamp” field formatting to mm-dd-yy. Select the entire column A, then Format =&amp;gt; Number =&amp;gt; More Formats. =&amp;gt; More date and time formats. Create a mm-dd-yy format. You can add a timestamp after the date if you prefer but it will not be used by the comments. Now it is time to use the magical ArrayFunction in the isAuthor column. The isAuthor provides us a boolean value of whether the commenter is the author by comparing the email address field. Insert the following formula in F2.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-js" data-lang="js"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;ArrayFormula(ISNUMBER(SEARCH(&lt;span style="color:#c30"&gt;&amp;#34;&amp;lt;insert email address&amp;gt;&amp;#34;&lt;/span&gt;, $E$2&lt;span style="color:#555"&gt;:&lt;/span&gt;E)))
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src="/sheets.png" alt="&amp;ldquo;Google sheets with formula&amp;rdquo;"&gt;&lt;em&gt;Google sheets with formula&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Let us set up firebase authentication using google as an auth provider. Create a new project in the firebase console and add a web app. Once the app is added, copy the setup code it provides. In the authentication section enable the required auth provider in the authentication tab under sign-in method tab.&lt;/p&gt;
&lt;p&gt;We are all set to dive into the eleventy and create the comments section. First create two new template names “comments.njk” and “firebase.njk”. The comments.njk file will contain the code for specific implementation of comments and firebase.njk will contain the code concerned with authentication of the user. Let us also add some data to our data file which I have named “site.json” in _data folder. This is where we will add all the links and name attributes we saved earlier. The name attributes we saved go in the postFields object&lt;/p&gt;
&lt;h6 id="_datasitejson"&gt;_data/site.json&lt;/h6&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;……,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;“comments”:&lt;/span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;“readUrl”:&lt;/span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;“&amp;lt;insert&lt;/span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;the&lt;/span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;google&lt;/span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;sheets&lt;/span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;link&amp;gt;”,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;“postUrl”:&lt;/span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;“&amp;lt;insert&lt;/span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;google&lt;/span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;form&lt;/span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;action&lt;/span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;link&amp;gt;”,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;“postFields”:&lt;/span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;[&lt;/span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;&amp;lt;post&lt;/span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;identifier&amp;gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;&amp;lt;name&amp;gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;&amp;lt;content&amp;gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;&amp;lt;email&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a00;background-color:#faa"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#a00;background-color:#faa"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Let us begin with the firebase code. Remember to insert the firebase setup code that we copied earlier at the top of the file. We initially set up the authentication provider project. The &lt;em&gt;authenticate()&lt;/em&gt; function is used to initiate the google auth on a button click. The &lt;em&gt;onAuthStateChanged()&lt;/em&gt; function allows us to perform actions when the state of user login changes&lt;/p&gt;
&lt;h6 id="firebasenjk"&gt;firebase.njk&lt;/h6&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-js" data-lang="js"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;****************************************
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;INSERT FIREBASE SETUP CODE
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;****************************************
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;script&lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;// Start a sign in process for an unauthenticated user.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#09f;font-style:italic"&gt;&lt;/span&gt;&lt;span style="color:#069;font-weight:bold"&gt;var&lt;/span&gt; provider &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;new&lt;/span&gt; firebase.auth.GoogleAuthProvider()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;provider.addScope(&lt;span style="color:#c30"&gt;&amp;#39;profile&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;provider.addScope(&lt;span style="color:#c30"&gt;&amp;#39;email&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;firebase.auth().signInWithRedirect(provider)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt; authenticate() {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;firebase.auth().getRedirectResult().then(&lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt;(result) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (result.credential) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;var&lt;/span&gt; token &lt;span style="color:#555"&gt;=&lt;/span&gt; result.credential.accessToken
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;var&lt;/span&gt; user &lt;span style="color:#555"&gt;=&lt;/span&gt; result.user
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;})
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; firebase.auth().onAuthStateChanged(&lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt;(user) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (user) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#366"&gt;document&lt;/span&gt;.getElementById(&lt;span style="color:#c30"&gt;&amp;#39;auth&amp;#39;&lt;/span&gt;).style.display &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#39;none&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#366"&gt;document&lt;/span&gt;.getElementById(&lt;span style="color:#c30"&gt;&amp;#39;comments-form&amp;#39;&lt;/span&gt;).style.display &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#39;block&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; name &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#366"&gt;document&lt;/span&gt;.getElementById(&lt;span style="color:#c30"&gt;&amp;#34;name&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; name.innerText &lt;span style="color:#555"&gt;=&lt;/span&gt; user.displayName
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; image &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#366"&gt;document&lt;/span&gt;.getElementById(&lt;span style="color:#c30"&gt;&amp;#34;image&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; image.src &lt;span style="color:#555"&gt;=&lt;/span&gt; user.photoURL
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#069;font-weight:bold"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; console.log(&lt;span style="color:#c30"&gt;&amp;#34;not logged in&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#366"&gt;document&lt;/span&gt;.getElementById(&lt;span style="color:#c30"&gt;&amp;#39;auth&amp;#39;&lt;/span&gt;).style.display &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span style="color:#a00;background-color:#faa"&gt;”&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#366"&gt;document&lt;/span&gt;.getElementById(&lt;span style="color:#c30"&gt;&amp;#39;comments-form&amp;#39;&lt;/span&gt;).style.display &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#39;none&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;})
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt; signOut() {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; firebase.auth().signOut()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;&lt;span style="color:#a00;background-color:#faa"&gt;/script&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The important part of implementing the UI is done in the “comments.njk” file. Let us begin by defining the html structure and CSS. A basic explanation of the structure is that we have a div that shows when there are no comments on that particular article. Then we have an auth and form component whose visibility depends on the auth state. Three of the form fields are hidden as the will be filled automatically from the user authentication and page url. Pleae not that the entire CSS is not attached here and also replace the variables with required values. The &amp;ldquo;&lt;em&gt;google.njk&lt;/em&gt;&amp;rdquo; is a google icon svg.&lt;/p&gt;
&lt;h6 id="commentsnjk"&gt;comments.njk&lt;/h6&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-html" data-lang="html"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;{% raw %}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;h2&lt;/span&gt; &lt;span style="color:#309"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;post-subtitle&amp;#34;&lt;/span&gt;&amp;gt;Comments&amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;h3&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt; &lt;span style="color:#309"&gt;id&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;commentSection&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;comments&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt; &lt;span style="color:#309"&gt;id&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;no-comments&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;post-info no-comments&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;p&lt;/span&gt;&amp;gt;There are currently no comments on this article, be the first to add one below!&amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;p&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;h3&lt;/span&gt; &lt;span style="color:#309"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;post-subtitle&amp;#34;&lt;/span&gt;&amp;gt;Add a Comment&amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;h3&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt; &lt;span style="color:#309"&gt;id&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;auth&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;style&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;display:none;&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt; &lt;span style="color:#309"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;post-info&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; You must authenticate with google in order to post comments.
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;button&lt;/span&gt; &lt;span style="color:#309"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;google-button&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;onclick&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;authenticate()&amp;#34;&lt;/span&gt;&amp;gt;&amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt; &lt;span style="color:#309"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;d-flex&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;style&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;justify-content:center;align-items:center;&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; {% include &amp;#39;icons/google.njk&amp;#39; %} Authenticate with Google
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;button&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt; &lt;span style="color:#309"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;comments&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;id&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;comments-form&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt; &lt;span style="color:#309"&gt;id&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;user&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;img&lt;/span&gt; &lt;span style="color:#309"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;image&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;id&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;image&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;span&lt;/span&gt; &lt;span style="color:#309"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;name&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;id&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;span&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;button&lt;/span&gt; &lt;span style="color:#309"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;button&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;id&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;button&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;onclick&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;signOut()&amp;#34;&lt;/span&gt;&amp;gt;Sign Out&amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;button&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;form&lt;/span&gt; &lt;span style="color:#309"&gt;onsubmit&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;return checkform()&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;action&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;https://docs.google.com/forms/u/0/d/e/1FAIpQLSdeT6VPXKvg5NLo2socJFISOGxkENzV3b1vYacoK8xr-ns7Lg/formResponse&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;target&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;comments_hidden_iframe&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;id&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;comment-form&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;autocomplete&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;off&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;input&lt;/span&gt; &lt;span style="color:#309"&gt;name&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;{{site.comments.postFields[0]}}&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;type&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;text&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;value&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;{{page.url}}&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;style&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;display:none&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;input&lt;/span&gt; &lt;span style="color:#309"&gt;name&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;{{site.comments.postFields[3]}}&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;type&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;text&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;id&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;email&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;style&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;display:none&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;input&lt;/span&gt; &lt;span style="color:#309"&gt;name&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;{{site.comments.postFields[1]}}&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;type&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;text&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;id&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;userName&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;style&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;display:none&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt; &lt;span style="color:#309"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;group&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;style&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;flex-grow:1;&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;textarea&lt;/span&gt; &lt;span style="color:#309"&gt;id&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;comment-content&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;maxlength&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;140&lt;/span&gt; &lt;span style="color:#309"&gt;name&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;{{site.comments.postFields[2]}}&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;form&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;comment-form&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;required&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;&amp;#34;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;textarea&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;span&lt;/span&gt; &lt;span style="color:#309"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;bar&amp;#34;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;span&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;label&lt;/span&gt;&amp;gt;Type in your comment&amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;label&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;input&lt;/span&gt; &lt;span style="color:#309"&gt;id&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;comment-submit&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;class&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;submitButton&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;type&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;submit&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;value&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;Post&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;form&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;div&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;iframe&lt;/span&gt; &lt;span style="color:#309"&gt;name&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;comments_hidden_iframe&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;id&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;comments_hidden_iframe&amp;#34;&lt;/span&gt; &lt;span style="color:#309"&gt;style&lt;/span&gt;&lt;span style="color:#555"&gt;=&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;display:none;&amp;#34;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;iframe&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&amp;lt;&lt;span style="color:#309;font-weight:bold"&gt;style&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;comments&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;margin-bottom&lt;/span&gt;: &lt;span style="color:#f60"&gt;2&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;rem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;no-comments&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;display&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;none&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;post-info&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;: &lt;span style="color:#c0f"&gt;var&lt;/span&gt;(&lt;span style="color:#555"&gt;--&lt;/span&gt;&lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;&lt;span style="color:#555"&gt;-&lt;/span&gt;&lt;span style="color:#069;font-weight:bold"&gt;text&lt;/span&gt;&lt;span style="color:#555"&gt;-&lt;/span&gt;offset);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;show&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;display&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;block&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;comment-name&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;font-size&lt;/span&gt;: &lt;span style="color:#f60"&gt;1.25&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;rem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;padding-right&lt;/span&gt;: &lt;span style="color:#f60"&gt;0.25&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;rem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;font-weight&lt;/span&gt;: &lt;span style="color:#f60"&gt;400&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;author-tag&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;: &lt;span style="color:#c0f"&gt;var&lt;/span&gt;(&lt;span style="color:#555"&gt;--&lt;/span&gt;&lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;&lt;span style="color:#555"&gt;-&lt;/span&gt;primary);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;comment-date&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;: &lt;span style="color:#c0f"&gt;var&lt;/span&gt;(&lt;span style="color:#555"&gt;--&lt;/span&gt;&lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;&lt;span style="color:#555"&gt;-&lt;/span&gt;&lt;span style="color:#069;font-weight:bold"&gt;text&lt;/span&gt;&lt;span style="color:#555"&gt;-&lt;/span&gt;offset);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;font-size&lt;/span&gt;: &lt;span style="color:#f60"&gt;0.8&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;rem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;comment-item&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;padding&lt;/span&gt;: &lt;span style="color:#f60"&gt;1&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;rem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;margin-bottom&lt;/span&gt;: &lt;span style="color:#f60"&gt;1&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;rem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;background&lt;/span&gt;: &lt;span style="color:#c0f"&gt;var&lt;/span&gt;(&lt;span style="color:#555"&gt;--&lt;/span&gt;&lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;&lt;span style="color:#555"&gt;-&lt;/span&gt;bg&lt;span style="color:#555"&gt;-&lt;/span&gt;offset);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;animation&lt;/span&gt;: fadeInUp &lt;span style="color:#f60"&gt;0.5&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;s&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;ease&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;google-button&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;padding&lt;/span&gt;: &lt;span style="color:#f60"&gt;0.5&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;rem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;font-size&lt;/span&gt;: &lt;span style="color:#f60"&gt;1.125&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;rem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;width&lt;/span&gt;: &lt;span style="color:#f60"&gt;100&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;background&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;transparent&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;outline&lt;/span&gt;: &lt;span style="color:#c0f"&gt;var&lt;/span&gt;(&lt;span style="color:#555"&gt;--&lt;/span&gt;&lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;&lt;span style="color:#555"&gt;-&lt;/span&gt;secondary);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;border&lt;/span&gt;: &lt;span style="color:#f60"&gt;1&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;px&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;solid&lt;/span&gt; &lt;span style="color:#c0f"&gt;var&lt;/span&gt;(&lt;span style="color:#555"&gt;--&lt;/span&gt;&lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;&lt;span style="color:#555"&gt;-&lt;/span&gt;secondary);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;: &lt;span style="color:#c0f"&gt;var&lt;/span&gt;(&lt;span style="color:#555"&gt;--&lt;/span&gt;&lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;&lt;span style="color:#555"&gt;-&lt;/span&gt;&lt;span style="color:#069;font-weight:bold"&gt;text&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;google-button&lt;/span&gt; &lt;span style="color:#309;font-weight:bold"&gt;svg&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;height&lt;/span&gt;: &lt;span style="color:#f60"&gt;2&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;rem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;padding-right&lt;/span&gt;: &lt;span style="color:#f60"&gt;1&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;rem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;google-button&lt;/span&gt;:&lt;span style="color:#99f"&gt;hover&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;: &lt;span style="color:#c0f"&gt;var&lt;/span&gt;(&lt;span style="color:#555"&gt;--&lt;/span&gt;&lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;&lt;span style="color:#555"&gt;-&lt;/span&gt;secondary);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;background&lt;/span&gt;: &lt;span style="color:#c0f"&gt;var&lt;/span&gt;(&lt;span style="color:#555"&gt;--&lt;/span&gt;&lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;&lt;span style="color:#555"&gt;-&lt;/span&gt;bg&lt;span style="color:#555"&gt;-&lt;/span&gt;offset);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;user&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;display&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;flex&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;justify-content&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;center&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;align-items&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;center&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;user&lt;/span&gt; .&lt;span style="color:#0a8;font-weight:bold"&gt;image&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;width&lt;/span&gt;: &lt;span style="color:#f60"&gt;3&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;rem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;height&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;auto&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;border-radius&lt;/span&gt;: &lt;span style="color:#f60"&gt;50&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;%&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;overflow&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;hidden&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;user&lt;/span&gt; .&lt;span style="color:#0a8;font-weight:bold"&gt;name&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;flex-grow&lt;/span&gt;: &lt;span style="color:#f60"&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;padding-left&lt;/span&gt;: &lt;span style="color:#f60"&gt;1&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;rem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;user&lt;/span&gt; .&lt;span style="color:#0a8;font-weight:bold"&gt;button&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;background&lt;/span&gt;: &lt;span style="color:#069;font-weight:bold"&gt;transparent&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;border&lt;/span&gt;: &lt;span style="color:#f60"&gt;1&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;px&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;solid&lt;/span&gt; &lt;span style="color:#c0f"&gt;var&lt;/span&gt;(&lt;span style="color:#555"&gt;--&lt;/span&gt;&lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;&lt;span style="color:#555"&gt;-&lt;/span&gt;primary);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;: &lt;span style="color:#c0f"&gt;var&lt;/span&gt;(&lt;span style="color:#555"&gt;--&lt;/span&gt;&lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;&lt;span style="color:#555"&gt;-&lt;/span&gt;primary);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;padding&lt;/span&gt;: &lt;span style="color:#f60"&gt;0.5&lt;/span&gt;&lt;span style="color:#078;font-weight:bold"&gt;rem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;.&lt;span style="color:#0a8;font-weight:bold"&gt;user&lt;/span&gt; .&lt;span style="color:#0a8;font-weight:bold"&gt;button&lt;/span&gt;:&lt;span style="color:#99f"&gt;hover&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;background&lt;/span&gt;: &lt;span style="color:#c0f"&gt;var&lt;/span&gt;(&lt;span style="color:#555"&gt;--&lt;/span&gt;&lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;&lt;span style="color:#555"&gt;-&lt;/span&gt;primary);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;: &lt;span style="color:#c0f"&gt;var&lt;/span&gt;(&lt;span style="color:#555"&gt;--&lt;/span&gt;&lt;span style="color:#069;font-weight:bold"&gt;color&lt;/span&gt;&lt;span style="color:#555"&gt;-&lt;/span&gt;bg);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&amp;lt;/&lt;span style="color:#309;font-weight:bold"&gt;style&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;{% endraw %}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The iframe tag is added to avoid the page refresh when the form is submitted. Once we add javascript in the next step, the comments component will function as follows.&lt;/p&gt;
&lt;p&gt;If the user is logged in, then the comment form will be visible along with the user profile and an option to sign out
&lt;img src="/empty_loggedin.png" alt="&amp;ldquo;Comments section with user logged in&amp;rdquo;"&gt;&lt;em&gt;Comments section with user logged in&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;If the user is not logged in, then the form is hidden away and the user has the option to sign in with google to login.
&lt;img src="/empty_loggedout.png" alt="&amp;ldquo;Comments section with user logged out&amp;rdquo;"&gt;&lt;em&gt;Comments section with user logged out&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;We are almost at the end. The final ingredient is the javascript logic. The &lt;em&gt;loadComments()&lt;/em&gt; makes a request to the sheet document with that particular page url and gets the comments that belong to it. The &lt;em&gt;displayComments()&lt;/em&gt; parses the csv that is returned and displays it by creating new elements for each comment. The checkForm() is used to verify if the user is signed in before submitting the comment. Once a new comment is submitted, the comments are reloaded and only new one are rendered.&lt;/p&gt;
&lt;h5 id="commentsnjk-1"&gt;comments.njk&lt;/h5&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-js" data-lang="js"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;script&lt;span style="color:#555"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;{&lt;span style="color:#555"&gt;%&lt;/span&gt; raw &lt;span style="color:#555"&gt;%&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; months &lt;span style="color:#555"&gt;=&lt;/span&gt; [&lt;span style="color:#c30"&gt;&amp;#34;Jan&amp;#34;&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#34;Feb&amp;#34;&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#34;Mar&amp;#34;&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#34;Apr&amp;#34;&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#34;May&amp;#34;&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#34;Jun&amp;#34;&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#34;Jul&amp;#34;&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#34;Aug&amp;#34;&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#34;Sep&amp;#34;&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#34;Oct&amp;#34;&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#34;Nov&amp;#34;&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#34;Dec&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; noComments &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#366"&gt;document&lt;/span&gt;.getElementById(&lt;span style="color:#c30"&gt;&amp;#34;no-comments&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; commentSection &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#366"&gt;document&lt;/span&gt;.getElementById(&lt;span style="color:#c30"&gt;&amp;#34;commentSection&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; pageUrl &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;{{ page.url }}&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; visibleComments &lt;span style="color:#555"&gt;=&lt;/span&gt; []
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt; formatDate(value) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt; months[&lt;span style="color:#069;font-weight:bold"&gt;new&lt;/span&gt; &lt;span style="color:#366"&gt;Date&lt;/span&gt;(value).getMonth()] &lt;span style="color:#555"&gt;+&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34; &amp;#34;&lt;/span&gt; &lt;span style="color:#555"&gt;+&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;new&lt;/span&gt; &lt;span style="color:#366"&gt;Date&lt;/span&gt;(value).getDate() &lt;span style="color:#555"&gt;+&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;, &amp;#34;&lt;/span&gt; &lt;span style="color:#555"&gt;+&lt;/span&gt; (&lt;span style="color:#069;font-weight:bold"&gt;new&lt;/span&gt; &lt;span style="color:#366"&gt;Date&lt;/span&gt;(value).getYear() &lt;span style="color:#555"&gt;+&lt;/span&gt; &lt;span style="color:#f60"&gt;1900&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt; encodeHTML(s) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt; s.replace(&lt;span style="color:#3aa"&gt;/&amp;amp;/g&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#39;&amp;amp;amp;&amp;#39;&lt;/span&gt;).replace(&lt;span style="color:#3aa"&gt;/&amp;lt;/g&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#39;&amp;amp;lt;&amp;#39;&lt;/span&gt;).replace(&lt;span style="color:#3aa"&gt;/&amp;#34;/g&lt;/span&gt;, &lt;span style="color:#c30"&gt;&amp;#39;&amp;amp;quot;&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt; encodeFormData(data) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt; &lt;span style="color:#366"&gt;Object&lt;/span&gt;.keys(data).map(k =&amp;gt; &lt;span style="color:#366"&gt;encodeURIComponent&lt;/span&gt;(k) &lt;span style="color:#555"&gt;+&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#39;=&amp;#39;&lt;/span&gt; &lt;span style="color:#555"&gt;+&lt;/span&gt; &lt;span style="color:#366"&gt;encodeURIComponent&lt;/span&gt;(data[k])).join(&lt;span style="color:#c30"&gt;&amp;#39;&amp;amp;&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt; displayComments(comments) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (comments &lt;span style="color:#555"&gt;==&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;null&lt;/span&gt; &lt;span style="color:#555"&gt;||&lt;/span&gt; comments &lt;span style="color:#555"&gt;==&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (visibleComments.length &lt;span style="color:#555"&gt;==&lt;/span&gt; &lt;span style="color:#f60"&gt;0&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; noComments.classList.add(&lt;span style="color:#c30"&gt;&amp;#34;show&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; console.log(comments)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; comments &lt;span style="color:#555"&gt;=&lt;/span&gt; comments.replace(&lt;span style="color:#3aa"&gt;/&amp;#34;/g&lt;/span&gt;,&lt;span style="color:#c30"&gt;&amp;#34;&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; commentList &lt;span style="color:#555"&gt;=&lt;/span&gt; comments.split(&lt;span style="color:#c30"&gt;&amp;#34;\n&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; commentList &lt;span style="color:#555"&gt;=&lt;/span&gt; commentList.map(&lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt;(k) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; temp &lt;span style="color:#555"&gt;=&lt;/span&gt; k.split(&lt;span style="color:#c30"&gt;&amp;#34;,&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; formatDate(temp[&lt;span style="color:#f60"&gt;0&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; temp[&lt;span style="color:#f60"&gt;3&lt;/span&gt;] &lt;span style="color:#555"&gt;=&lt;/span&gt; (temp[&lt;span style="color:#f60"&gt;3&lt;/span&gt;] &lt;span style="color:#555"&gt;==&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;TRUE&amp;#34;&lt;/span&gt; &lt;span style="color:#555"&gt;?&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;true&lt;/span&gt; &lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;false&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt; temp
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; })
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; commentList.forEach(&lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt;(element) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (visibleComments.includes(JSON.stringify(element))) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; authorTag &lt;span style="color:#555"&gt;=&lt;/span&gt; element[&lt;span style="color:#f60"&gt;3&lt;/span&gt;] &lt;span style="color:#555"&gt;?&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;true&lt;/span&gt; &lt;span style="color:#555"&gt;:&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; item &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#366"&gt;document&lt;/span&gt;.createElement(&lt;span style="color:#c30"&gt;&amp;#34;div&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; item.className &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;comment-item&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; title &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#366"&gt;document&lt;/span&gt;.createElement(&lt;span style="color:#c30"&gt;&amp;#34;div&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; title.className &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;comment-title&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; titleText &lt;span style="color:#555"&gt;=&lt;/span&gt; encodeHTML(element[&lt;span style="color:#f60"&gt;1&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; name &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#366"&gt;document&lt;/span&gt;.createElement(&lt;span style="color:#c30"&gt;&amp;#34;span&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; date &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#366"&gt;document&lt;/span&gt;.createElement(&lt;span style="color:#c30"&gt;&amp;#34;div&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; date.className &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;comment-date&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; name.className &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;comment-name&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; date.append(formatDate(element[&lt;span style="color:#f60"&gt;0&lt;/span&gt;]))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; name.append(titleText)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; title.append(name)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (authorTag) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; author &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#366"&gt;document&lt;/span&gt;.createElement(&lt;span style="color:#c30"&gt;&amp;#34;small&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; author.className &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;author-tag&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; author.innerText &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;Author&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; title.append(author)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; title.append(date)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; comment &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#366"&gt;document&lt;/span&gt;.createElement(&lt;span style="color:#c30"&gt;&amp;#34;div&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; comment.className &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;comment-content&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; commentText &lt;span style="color:#555"&gt;=&lt;/span&gt; encodeHTML(element[&lt;span style="color:#f60"&gt;2&lt;/span&gt;].replace(&lt;span style="color:#069;font-weight:bold"&gt;new&lt;/span&gt; &lt;span style="color:#366"&gt;RegExp&lt;/span&gt;(&lt;span style="color:#c30"&gt;&amp;#39;\r?\n&amp;#39;&lt;/span&gt;,&lt;span style="color:#c30"&gt;&amp;#39;g&amp;#39;&lt;/span&gt;), &lt;span style="color:#c30"&gt;&amp;#39;&amp;lt;br /&amp;gt;&amp;#39;&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; comment.append(commentText)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; item.append(title)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; item.append(comment)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; commentSection.append(item)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; visibleComments.push(JSON.stringify(element))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; noComments.classList.remove(&lt;span style="color:#c30"&gt;&amp;#34;show&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; })
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt; loadComments() {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;var&lt;/span&gt; sqlQuery &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#366"&gt;encodeURIComponent&lt;/span&gt;(&lt;span style="color:#c30"&gt;`SELECT A, C,D, F WHERE B =&amp;#34;&lt;/span&gt;&lt;span style="color:#a00"&gt;${&lt;/span&gt;pageUrl&lt;span style="color:#a00"&gt;}&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;#34;`&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; fetch (&lt;span style="color:#c30"&gt;`{{site.comments.readUrl}}/gviz/tq?tqx=out:csv&amp;amp;sheet=comments&amp;amp;tq=&lt;/span&gt;&lt;span style="color:#a00"&gt;${&lt;/span&gt;sqlQuery&lt;span style="color:#a00"&gt;}&lt;/span&gt;&lt;span style="color:#c30"&gt;&amp;amp;headers=0`&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; .then(response =&amp;gt; response.text())
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; .then(response =&amp;gt; displayComments(response))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;let&lt;/span&gt; commentIframe &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#366"&gt;document&lt;/span&gt;.getElementById(&lt;span style="color:#c30"&gt;&amp;#34;comments_hidden_iframe&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; commentIframe.addEventListener(&lt;span style="color:#c30"&gt;&amp;#34;load&amp;#34;&lt;/span&gt;, &lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt;(){submit()}, &lt;span style="color:#069;font-weight:bold"&gt;true&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt; submit() {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#366"&gt;document&lt;/span&gt;.getElementById(&lt;span style="color:#c30"&gt;&amp;#34;comment-content&amp;#34;&lt;/span&gt;).value &lt;span style="color:#555"&gt;=&lt;/span&gt; &lt;span style="color:#c30"&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; showSnackbar(&lt;span style="color:#c30"&gt;&amp;#34;Submitted Comment&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; loadComments()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;function&lt;/span&gt; checkform() {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;if&lt;/span&gt; (firebase.auth().currentUser) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#366"&gt;document&lt;/span&gt;.getElementById(&lt;span style="color:#c30"&gt;&amp;#34;email&amp;#34;&lt;/span&gt;).value &lt;span style="color:#555"&gt;=&lt;/span&gt; firebase.auth().currentUser.email
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#366"&gt;document&lt;/span&gt;.getElementById(&lt;span style="color:#c30"&gt;&amp;#34;userName&amp;#34;&lt;/span&gt;).value &lt;span style="color:#555"&gt;=&lt;/span&gt; firebase.auth().currentUser.displayName
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; alert(&lt;span style="color:#c30"&gt;&amp;#34;Authenticate with google to sign in&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#069;font-weight:bold"&gt;return&lt;/span&gt; &lt;span style="color:#069;font-weight:bold"&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; loadComments()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#555"&gt;&amp;lt;&lt;/span&gt;&lt;span style="color:#a00;background-color:#faa"&gt;/script&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; {&lt;span style="color:#555"&gt;%&lt;/span&gt; include &lt;span style="color:#c30"&gt;&amp;#39;firebase.njk&amp;#39;&lt;/span&gt; &lt;span style="color:#555"&gt;%&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;{&lt;span style="color:#555"&gt;%&lt;/span&gt; endraw &lt;span style="color:#555"&gt;%&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Include the comments layout in the proper location in the post and voila! There we have it, a simple working comments section for a static site with just google sheets and forms and authentication for a static website with firebase auth.&lt;/p&gt;
&lt;p&gt;Until next time, adiós!&lt;/p&gt;</description></item></channel></rss>